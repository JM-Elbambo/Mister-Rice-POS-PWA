<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mister Rice POS System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .product-suggestion {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .product-suggestion:hover {
            background-color: var(--bs-secondary-bg);
        }

        .product-suggestion:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body data-bs-theme="dark">
    <div id="component-navbar"></div>

    <!-- Main Content -->
    <main class="container" id="main-content">
        <div class="row">
            <!-- Left Column - Product Search -->
            <div class="col-lg-6 col-md-12 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h4 class="card-title mb-3"><i class="fas fa-search me-2"></i>Product Search</h4>
                        
                        <!-- Search Input -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="productSearch" placeholder="Enter product name or barcode..." onkeyup="searchProducts(event)">
                            <button class="btn btn-success" type="button" onclick="simulateBarcodeScan()">
                                <i class="fas fa-barcode me-2"></i>Scan
                            </button>
                        </div>

                        <!-- Product Suggestions -->
                        <div id="productSuggestions" class="d-none">
                            <h6 class="text-muted mb-2">Suggestions:</h6>
                            <div id="suggestionsList" class="border rounded"></div>
                        </div>

                        <!-- Quick Add Products -->
                        <div class="mt-4">
                            <h6 class="text-muted mb-3">Quick Add Popular Items:</h6>
                            <div class="row g-2">
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('Jasmine Rice 5kg', 250.00)">
                                        <small>Jasmine Rice 5kg<br>₱250.00</small>
                                    </button>
                                </div>
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('Basmati Rice 1kg', 180.00)">
                                        <small>Basmati Rice 1kg<br>₱180.00</small>
                                    </button>
                                </div>
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('Brown Rice 2kg', 320.00)">
                                        <small>Brown Rice 2kg<br>₱320.00</small>
                                    </button>
                                </div>
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('White Rice 10kg', 450.00)">
                                        <small>White Rice 10kg<br>₱450.00</small>
                                    </button>
                                </div>
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('Sticky Rice 1kg', 200.00)">
                                        <small>Sticky Rice 1kg<br>₱200.00</small>
                                    </button>
                                </div>
                                <div class="col-6 col-sm-4">
                                    <button class="btn btn-outline-primary w-100 btn-sm" onclick="addProduct('Red Rice 1kg', 150.00)">
                                        <small>Red Rice 1kg<br>₱150.00</small>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Shopping Cart -->
            <div class="col-lg-6 col-md-12 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="card-title mb-0"><i class="fas fa-shopping-cart me-2"></i>Shopping Cart</h4>
                            <button class="btn btn-outline-danger btn-sm" onclick="clearCart()">
                                <i class="fas fa-trash me-1"></i>Clear
                            </button>
                        </div>

                        <!-- Cart Items -->
                        <div id="cartItems">
                            <div class="text-center py-5 text-muted">
                                <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                                <p>Your cart is empty</p>
                                <small>Start adding products to begin a transaction</small>
                            </div>
                        </div>

                        <!-- Discount Section -->
                        <div class="mt-3">
                            <div class="row g-2">
                                <div class="col-8">
                                    <input type="number" class="form-control" id="discountInput" placeholder="Discount amount" min="0" step="0.01">
                                </div>
                                <div class="col-4">
                                    <select class="form-select" id="discountType">
                                        <option value="fixed">₱</option>
                                        <option value="percent">%</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-warning w-100 mt-2" onclick="applyDiscount()">
                                <i class="fas fa-tag me-2"></i>Apply Discount
                            </button>
                        </div>

                        <!-- Payment Section -->
                        <div class="bg-secondary-subtle rounded p-3 mt-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <span id="subtotal">₱0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Discount:</span>
                                <span id="discount" class="text-warning">-₱0.00</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between h5 mb-3">
                                <strong>Total:</strong>
                                <strong id="total">₱0.00</strong>
                            </div>
                            
                            <!-- Change Calculator -->
                            <div class="mb-3">
                                <label class="form-label mb-2"><i class="fas fa-money-bill me-2"></i>Amount Paid:</label>
                                <div class="input-group mb-2">
                                    <span class="input-group-text">₱</span>
                                    <input type="number" class="form-control" id="amountPaid" placeholder="0.00" min="0" step="0.01" oninput="calculateChange()">
                                </div>
                                <div class="d-flex justify-content-between align-items-center p-2 bg-info-subtle rounded" id="changeSection" style="display: none;">
                                    <span><strong>Change:</strong></span>
                                    <span class="h5 mb-0 text-success" id="changeAmount">₱0.00</span>
                                </div>
                            </div>
                            
                            <button class="btn btn-success w-100 btn-lg" onclick="processPayment()" id="checkoutBtn" disabled>
                                <i class="fas fa-credit-card me-2"></i>Process Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Payment Successful</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h4>Transaction Complete!</h4>
                    <div class="row text-start mt-4">
                        <div class="col-6"><strong>Total Amount:</strong></div>
                        <div class="col-6" id="finalTotal">₱0.00</div>
                        <div class="col-6"><strong>Amount Paid:</strong></div>
                        <div class="col-6" id="finalAmountPaid">₱0.00</div>
                        <div class="col-6"><strong>Change:</strong></div>
                        <div class="col-6 text-success" id="finalChange">₱0.00</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="printReceipt()">
                        <i class="fas fa-print me-2"></i>Print Receipt
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="newTransaction()">New Transaction</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./js/main.js"></script>
    <script>
        // Global variables
        let cart = [];
        let subtotal = 0;
        let discountAmount = 0;
        let total = 0;
        let amountPaid = 0;
        let change = 0;

        // Sample products database
        const products = [
            { name: "Jasmine Rice 5kg", price: 250.00, barcode: "1234567890123" },
            { name: "Basmati Rice 1kg", price: 180.00, barcode: "1234567890124" },
            { name: "Brown Rice 2kg", price: 320.00, barcode: "1234567890125" },
            { name: "White Rice 10kg", price: 450.00, barcode: "1234567890126" },
            { name: "Sticky Rice 1kg", price: 200.00, barcode: "1234567890127" },
            { name: "Red Rice 1kg", price: 150.00, barcode: "1234567890128" },
            { name: "Organic Rice 2kg", price: 380.00, barcode: "1234567890129" },
            { name: "Premium Jasmine 1kg", price: 120.00, barcode: "1234567890130" }
        ];
        
        // Product search functionality
        function searchProducts(event) {
            const query = event.target.value.toLowerCase().trim();
            const suggestionsDiv = document.getElementById('productSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            
            if (query.length < 2) {
                suggestionsDiv.classList.add('d-none');
                return;
            }

            const matches = products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.barcode.includes(query)
            );

            if (matches.length > 0) {
                suggestionsList.innerHTML = matches.map(product => `
                    <div class="product-suggestion p-3 border-bottom" onclick="addProduct('${product.name}', ${product.price})">
                        <div class="d-flex justify-content-between">
                            <span>${product.name}</span>
                            <strong>₱${product.price.toFixed(2)}</strong>
                        </div>
                        <small class="text-muted">Barcode: ${product.barcode}</small>
                    </div>
                `).join('');
                suggestionsDiv.classList.remove('d-none');
            } else {
                suggestionsDiv.classList.add('d-none');
            }

            // Handle Enter key
            if (event.key === 'Enter' && matches.length > 0) {
                addProduct(matches[0].name, matches[0].price);
                event.target.value = '';
                suggestionsDiv.classList.add('d-none');
            }
        }

        // Simulate barcode scan
        function simulateBarcodeScan() {
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            addProduct(randomProduct.name, randomProduct.price);
            document.getElementById('productSearch').value = '';
            document.getElementById('productSuggestions').classList.add('d-none');
        }

        // Add product to cart
        function addProduct(name, price) {
            const existingItem = cart.find(item => item.name === name);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    name: name,
                    price: price,
                    quantity: 1,
                    id: Date.now() + Math.random()
                });
            }
            
            updateCartDisplay();
            calculateTotals();
        }

        // Update cart display
        function updateCartDisplay() {
            const cartItemsDiv = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                        <p>Your cart is empty</p>
                        <small>Start adding products to begin a transaction</small>
                    </div>
                `;
            } else {
                cartItemsDiv.innerHTML = cart.map(item => `
                    <div class="border-bottom py-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">${item.name}</h6>
                                <small class="text-muted">₱${item.price.toFixed(2)} each</small>
                            </div>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeItem(${item.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(${item.id}, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="btn btn-outline-secondary btn-sm disabled">${item.quantity}</span>
                                <button class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(${item.id}, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <strong>₱${(item.price * item.quantity).toFixed(2)}</strong>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Change item quantity
        function changeQuantity(itemId, delta) {
            const item = cart.find(item => item.id === itemId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeItem(itemId);
                } else {
                    updateCartDisplay();
                    calculateTotals();
                }
            }
        }

        // Remove item from cart
        function removeItem(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartDisplay();
            calculateTotals();
        }

        // Clear entire cart
        function clearCart() {
            cart = [];
            discountAmount = 0;
            amountPaid = 0;
            change = 0;
            document.getElementById('discountInput').value = '';
            document.getElementById('amountPaid').value = '';
            document.getElementById('changeSection').style.display = 'none';
            updateCartDisplay();
            calculateTotals();
        }

        // Calculate change
        function calculateChange() {
            const amountPaidInput = document.getElementById('amountPaid');
            const changeSection = document.getElementById('changeSection');
            const changeAmountSpan = document.getElementById('changeAmount');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            amountPaid = parseFloat(amountPaidInput.value) || 0;
            change = amountPaid - total;
            
            if (amountPaid > 0 && total > 0) {
                changeSection.style.display = 'flex';
                
                if (change >= 0) {
                    changeAmountSpan.textContent = `₱${change.toFixed(2)}`;
                    changeAmountSpan.className = 'h5 mb-0 text-success';
                    checkoutBtn.disabled = false;
                } else {
                    changeAmountSpan.textContent = `₱${change.toFixed(2)} (Insufficient)`;
                    changeAmountSpan.className = 'h5 mb-0 text-danger';
                    checkoutBtn.disabled = true;
                }
            } else {
                changeSection.style.display = 'none';
                checkoutBtn.disabled = cart.length === 0 || total <= 0;
            }
        }

        // Calculate totals
        function calculateTotals() {
            subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            total = subtotal - discountAmount;
            
            document.getElementById('subtotal').textContent = `₱${subtotal.toFixed(2)}`;
            document.getElementById('discount').textContent = `-₱${discountAmount.toFixed(2)}`;
            document.getElementById('total').textContent = `₱${total.toFixed(2)}`;
            
            // Recalculate change when totals change
            calculateChange();
        }

        // Apply discount
        function applyDiscount() {
            const discountInput = document.getElementById('discountInput').value;
            const discountType = document.getElementById('discountType').value;
            
            if (!discountInput || parseFloat(discountInput) <= 0) {
                alert('Please enter a valid discount amount');
                return;
            }

            if (subtotal === 0) {
                alert('Add items to cart before applying discount');
                return;
            }

            if (discountType === 'percent') {
                discountAmount = (subtotal * parseFloat(discountInput)) / 100;
            } else {
                discountAmount = parseFloat(discountInput);
            }

            // Ensure discount doesn't exceed subtotal
            if (discountAmount > subtotal) {
                discountAmount = subtotal;
            }

            calculateTotals();
        }

        // Process payment
        function processPayment() {
            if (cart.length === 0) return;
            if (amountPaid < total) {
                alert('Insufficient payment amount');
                return;
            }
            
            document.getElementById('finalTotal').textContent = `₱${total.toFixed(2)}`;
            document.getElementById('finalAmountPaid').textContent = `₱${amountPaid.toFixed(2)}`;
            document.getElementById('finalChange').textContent = `₱${change.toFixed(2)}`;
            
            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
        }

        // Print receipt (placeholder)
        function printReceipt() {
            alert('Receipt printing functionality would be implemented here');
        }

        // Start new transaction
        function newTransaction() {
            clearCart();
            const modal = bootstrap.Modal.getInstance(document.getElementById('successModal'));
            modal.hide();
        }

        // Initialize
        calculateTotals();
    </script>
</body>
</html>
